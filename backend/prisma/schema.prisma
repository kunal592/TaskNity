// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================================
// ENUMS
// =============================================

enum Role {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

enum Priority {
  HIGH
  MEDIUM
  LOW
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  REMOTE
  ON_LEAVE
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

// =============================================
// MODELS
// =============================================

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed with bcrypt
  name      String
  role      Role     @default(MEMBER)
  team      String?
  phone     String?
  address   String?
  joinedAt  DateTime @default(now())

  // Relations
  projects   Project[]    @relation("ProjectMembers")
  tasks      Task[]       @relation("TaskAssignees")
  attendance Attendance[]
  leaves     Leave[]
  expenses   Expense[]

  // Kudos
  kudosGiven    Kudos[] @relation("KudosGiven")
  kudosReceived Kudos[] @relation("KudosReceived")

  // Meetings
  meetingsOrganized Meeting[] @relation("MeetingsOrganized")
  meetingsAttending Meeting[] @relation("MeetingAttendees")

  // Announcements
  announcements Announcement[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Project {
  id       String  @id @default(uuid())
  title    String
  progress Int     @default(0)
  isPublic Boolean @default(true)

  // Relations
  members User[]  @relation("ProjectMembers")
  tasks   Task[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Task {
  id          String     @id @default(uuid())
  title       String
  description String?
  status      TaskStatus @default(TODO)
  priority    Priority   @default(MEDIUM)
  deadline    DateTime?
  classified  Boolean    @default(false)
  isDraft     Boolean    @default(false)

  // Relations
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  assignees User[] @relation("TaskAssignees")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Attendance {
  id     String           @id @default(uuid())
  date   DateTime         @db.Date
  status AttendanceStatus

  // Relations
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, date]) // One entry per user per day
}

model Leave {
  id     String        @id @default(uuid())
  reason String
  date   DateTime      @db.Date
  status RequestStatus @default(PENDING)

  // Relations
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Expense {
  id       String        @id @default(uuid())
  title    String
  category String
  amount   Float
  date     DateTime      @db.Date
  status   RequestStatus @default(PENDING)

  // Relations
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// =============================================
// TEAM CULTURE & COLLABORATION
// =============================================

model Kudos {
  id      String @id @default(uuid())
  message String
  emoji   String @default("ðŸŽ‰")

  // Who gave and received
  fromUserId String
  fromUser   User   @relation("KudosGiven", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUserId   String
  toUser     User   @relation("KudosReceived", fields: [toUserId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

model Meeting {
  id          String   @id @default(uuid())
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  location    String?  // "Zoom", "Office Room 1", etc.
  link        String?  // Meeting URL

  // Organizer
  organizerId String
  organizer   User   @relation("MeetingsOrganized", fields: [organizerId], references: [id], onDelete: Cascade)

  // Attendees
  attendees User[] @relation("MeetingAttendees")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Announcement {
  id       String   @id @default(uuid())
  title    String
  content  String
  priority Priority @default(MEDIUM)
  pinned   Boolean  @default(false)

  // Author
  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
